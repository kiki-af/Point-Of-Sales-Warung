/*!
 * Point Of Sales Warung
 * Licensed under GPL (https://github.com/rezafikkri/Point-Of-Sales-Warung/blob/master/LICENSE)
 */
!function(){"use strict";function t(t,e){e.classList.replace("modal__content--animate-show","modal__content--animate-hide"),setTimeout((()=>{e.classList.remove("modal__content--animate-hide"),t.classList.replace("modal--fade-in","modal--fade-out")}),100),setTimeout((()=>{t.classList.remove("modal--fade-out"),t.classList.remove("modal--show"),t.classList.remove("d-block")}),200)}function e(t,e){const a=document.createElement("div");return a.classList.add("alert"),a.classList.add(t),a.classList.add("mb-3"),a.innerHTML=`<span class="alert__icon"></span>\n    <p>${e}</p>\n    <a class="alert__close" href="#"></a>`,a}function a(t){return t.toLocaleString("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0})}const r=document.querySelector("main.main"),n=document.querySelector("a#show-cart"),o=document.querySelector("a#search-product"),d=document.querySelector("a#cancel-transaction"),s=document.querySelector("a#finish-transaction"),l=document.querySelector("aside.cart table.table");function c(t,e){let r="",n=0,o=0;e.forEach((t=>{const e=parseInt(t.harga_produk)*parseInt(t.jumlah_produk);r+=`<tr data-product-id="${t.produk_id}" data-transaction-detail-id="${t.transaksi_detail_id}">\n            <td width="10"><a href="#" title="Hapus produk" id="remove-product"  class="text-hover-red">\n                <svg xmlns="http://www.w3.org/2000/svg" width="19" fill="currentColor" viewBox="0 0 16 16"><path d="M2.037 3.225l1.684 10.104A2 2 0 0 0 5.694 15h4.612a2 2 0 0 0 1.973-1.671l1.684-10.104C13.627 4.224 11.085 5 8 5c-3.086 0-5.627-.776-5.963-1.775z"/><path fill-rule="evenodd" d="M12.9 3c-.18-.14-.497-.307-.974-.466C10.967 2.214 9.58 2 8 2s-2.968.215-3.926.534c-.477.16-.795.327-.975.466.18.14.498.307.975.466C5.032 3.786 6.42 4 8 4s2.967-.215 3.926-.534c.477-.16.795-.327.975-.466zM8 5c3.314 0 6-.895 6-2s-2.686-2-6-2-6 .895-6 2 2.686 2 6 2z"/></svg>\n            </a></td>\n            <td width="10"><a href="#" title="Tambah jumlah produk" id="add-product-qty">\n                <svg xmlns="http://www.w3.org/2000/svg" width="17" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 11.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V11.5z"/></svg>\n            </a></td>\n            <td width="10"><a href="#" title="Kurangi jumlah produk" id="reduce-product-qty">\n                <svg xmlns="http://www.w3.org/2000/svg" width="17" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V4.5z"/></svg>\n            </a></td>\n            <td>${t.nama_produk}</td>\n            <td id="price" data-price="${t.harga_produk}">\n                ${a(parseInt(t.harga_produk))} / ${t.besaran_produk}\n            </td>\n            <td id="qty" data-qty="${t.jumlah_produk}">${t.jumlah_produk}</td>\n            <td id="payment" data-payment="${e}">${a(e)}</td>\n        </tr>`,n+=e,o+=parseInt(t.jumlah_produk)})),""!==r&&(t.querySelector("tbody").innerHTML=r),t.querySelector("td#total-qty").innerText=o,t.querySelector("td#total-payment").innerText=a(n),t.querySelector("td#total-qty").dataset.totalQty=o,t.querySelector("td#total-payment").dataset.totalPayment=n}const i=document.querySelector("aside.cart");n.addEventListener("click",(t=>{t.preventDefault(),i.classList.add("cart--animate-show"),setTimeout((()=>{i.classList.remove("cart--animate-show"),i.classList.add("cart--show"),window.screen.width<=991.98&&document.querySelector("body").classList.add("overflow-hidden")}),500);const e=r.dataset.csrfName,a=r.dataset.csrfValue;null===l.getAttribute("aria-label")&&function(t,e,a,r,n){document.querySelector("div#cart-loading").classList.remove("d-none"),r.classList.add("btn--disabled"),fetch("/kasir/tampil_transaksi_detail",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`${e}=${a}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none"),r.classList.remove("btn--disabled")})).then((t=>t.json())).then((e=>{if(void 0!==e.csrf_value&&(n.dataset.csrfValue=e.csrf_value),null!==e.transaction_details)if(c(t,e.transaction_details),"transaction"===e.type)t.setAttribute("aria-label","transaction");else if("rollback-transaction"===e.type){const a=parseInt(e.customer_money);document.querySelector('input[name="customer_money"]').value=a,p(a,parseInt(t.querySelector("td#total-payment").dataset.totalPayment)),t.setAttribute("aria-label","rollback-transaction"),t.setAttribute("data-transaction-id",e.transaction_id)}})).catch((t=>{console.error(t)}))}(l,e,a,t.target,r)}));const u=i.querySelector("a#btn-close");function p(t,e){const r=document.querySelector('input[name="change_money"]');t>=e?r.value=a(t-e):""!==r.value&&(r.value="")}u.addEventListener("click",(t=>{t.preventDefault(),i.classList.replace("cart--show","cart--animate-hide"),setTimeout((()=>{i.classList.remove("cart--animate-hide")}),450),document.querySelector("body").classList.remove("overflow-hidden")})),r.addEventListener("change",(t=>{let e=t.target;if("magnitude"===e.getAttribute("name")){const t=e.selectedOptions[0].dataset.productPrice;e.previousElementSibling.previousElementSibling.innerText=a(parseInt(t))}})),o.addEventListener("click",(t=>{t.preventDefault();const e=r.querySelector("div.container-xl"),a=document.querySelector('input[name="product_name_search"]').value,n=r.dataset.csrfName,d=r.dataset.csrfValue;if(""===a.trim())return!1;e.innerHTML='<div id="search-loading" class="d-flex justify-content-center align-items-center mt-4">\n    <div class="loading"><div></div></div>\n</div>',o.classList.add("btn--disabled"),fetch("/kasir/cari_produk",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`keyword=${a}&${n}=${d}`}).finally((()=>{e.querySelector("div#search-loading").remove(),o.classList.remove("btn--disabled")})).then((t=>t.json())).then((t=>{if(void 0!==t.csrf_value&&(r.dataset.csrfValue=t.csrf_value),t.products_db.length>0){const a=r.dataset.baseUrl;let n=`<span class="text-muted me-1 d-block mb-3" id="result-status">\n                    1 - ${t.products_db.length} dari ${t.product_search_total} Total produk hasil pencarian</span>`;n+='<h5 class="mb-2 main__title">Produk</h5><div class="product mb-4">',t.products_db.forEach((t=>{const e=null!==t.product_sale?t.product_sale:0;n+=`<div class="product__item" data-product-id="${t.product_id}">\n                    <div class="product__image">\n                        <img src="${a}/dist/images/product_photo/${t.product_photo}" alt="${t.product_name}">\n                    </div>\n                    <div class="product__info">\n                        <p class="product__name">${t.product_name}</p>\n                        <p class="product__category">${t.category_name}</p>\n                        <p class="product__sale" data-product-sale="${e}">Terjual ${e}</p>\n\n                        <div class="product__price">\n                            <h5>${t.product_price[0].product_price}</h5><span>/</span>\n                            <select name="magnitude">`,t.product_price.forEach((t=>{n+=`<option data-product-price="${t.product_price}" value="${t.product_price_id}">\n                                        ${t.product_magnitude}</option>`})),n+='</select>\n                        </div>\n                    </div>\n                    <div class="product__action">\n                        <input type="number" class="form-input" name="product_qty" placeholder="Jumlah..." min="1">\n                        <a class="btn" href="#" id="buy-rollback" title="Tambah ke keranjang belanja">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="18" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm7 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>\n                        </a>\n                    </div>\n                </div>\x3c!-- product__item --\x3e'})),n+="</div>\x3c!-- product --\x3e",e.innerHTML=n}else{let t='<span class="text-muted me-1 d-block mb-3" id="result-status">0 Total produk hasil pencarian</span>\n                <h5 class="mb-2 main__title">Produk</h5><div class="product mb-4">\n                <p>Produk tidak ada.</p>';e.innerHTML=t}const a=document.querySelector("span#limit-message");if(t.products_db.length===t.product_limit&&null===a){const e=document.createElement("span");e.classList.add("text-muted"),e.classList.add("d-block"),e.classList.add("mb-5"),e.setAttribute("id","limit-message"),e.innerHTML=`Hanya ${t.product_limit} Produk terbaru yang ditampilkan, Pakai fitur <i>Pencarian</i> untuk hasil lebih spesifik!`,document.querySelector("div.product").after(e)}else t.products_db.length!==t.product_limit&&null!==a&&a.remove()})).catch((t=>{console.error(t)}))}));let m=!0;function y(t,e,r,n,o,d,s,l,c,i,u,m){if(r<=0)return!1;let y=`product_qty_new=${r}&transaction_detail_id=${c}&${i}=${u}`;"rollback-transaction"===e.getAttribute("aria-label")&&(y+=`&transaction_id=${e.dataset.transactionId}`),document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/ubah_jumlah_produk",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:y}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((s=>{if(void 0!==s.csrf_value&&(m.dataset.csrfValue=s.csrf_value),!0===s.success){const s=t.parentElement.parentElement;s.querySelector("td#qty").innerText=r,s.querySelector("td#qty").dataset.qty=r,s.querySelector("td#payment").innerText=a(o),s.querySelector("td#payment").dataset.payment=o,e.querySelector("td#total-qty").innerText=n,e.querySelector("td#total-qty").dataset.totalQty=n,e.querySelector("td#total-payment").innerText=a(d),e.querySelector("td#total-payment").dataset.totalPayment=d;const c=document.querySelector(`div.product__item[data-product-id="${s.dataset.productId}"] p.product__sale`);null!==c&&(c.innerText=`Terjual ${l}`,c.dataset.productSale=l);p(parseInt(document.querySelector('input[name="customer_money"]').value),d)}})).catch((t=>{console.error(t)}))}function _(t){t.querySelector("tbody").innerHTML='<tr id="empty-shopping-cart"><td colspan="7"></td></tr>',t.querySelector("td#total-qty").innerText=0,t.querySelector("td#total-qty").dataset.totalQty=0,t.querySelector("td#total-payment").innerText="Rp 0",t.querySelector("td#total-payment").dataset.totalPayment=0,document.querySelector('input[name="customer_money"]').value="",document.querySelector('input[name="change_money"]').value="",t.removeAttribute("aria-label");const e=document.querySelectorAll("aside.cart small.form-message");e.length>0&&e.forEach((t=>t.remove()))}function v(t,e){const a=document.querySelector("aside.cart div#customer-money small.form-message");if(null!==a)a.innerText=t;else{const t=document.createElement("small");t.classList.add("form-message"),t.classList.add(`form-message--${e}`),t.innerText=json.form_errors.customer_money,document.querySelector("aside.cart div#customer-money").append(t)}}function h(t,e,a,r){const n=a.querySelectorAll("tbody tr[data-product-id]"),o=function(t){let e=[];return t.forEach(((t,a)=>{e[a]=t.dataset.transactionDetailId})),e}(n);document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/rollback_transaksi_batal",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`transaction_detail_ids=${o}&${t}=${e}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((t=>{if(void 0!==t.csrf_value&&(r.dataset.csrfValue=t.csrf_value),!0===t.success){(function(t,e){let a=[],r=0;for(const n of e){let e=!1;for(const a of t)if(n.dataset.productId===a.produk_id){e=!0;break}!1===e&&(a[r]={product_id:n.dataset.productId,product_qty:parseInt(n.querySelector("td#qty").dataset.qty)},r++)}for(const n of t){let t=0;for(const a of e)if(n.produk_id===a.dataset.productId){t=a.querySelector("td#qty").dataset.qty;break}let o=0;o=0!==t?parseInt(t)-n.jumlah_produk:0-n.jumlah_produk,a[r]={product_id:n.produk_id,product_qty:o},r++}return a})(t.transaction_details,n).forEach((t=>{const e=document.querySelector(`div.product__item[data-product-id="${t.product_id}"] p.product__sale`);if(null!==e){const a=parseInt(e.dataset.productSale)-t.product_qty;e.dataset.productSale=a,e.innerText=`Terjual ${a}`}})),a.removeAttribute("data-transaction-id"),_(a)}})).catch((t=>{console.error(t)}))}document.querySelector('aside.cart input[name="customer_money"]').addEventListener("input",(t=>{!0===m&&(m=!1,setTimeout((()=>{p(parseInt(t.target.value),parseInt(document.querySelector("aside.cart td#total-payment").dataset.totalPayment)),m=!0}),300))})),r.querySelector("div.container-xl").addEventListener("click",(t=>{let e=t.target;if("buy-rollback"!==e.getAttribute("id")&&(e=e.parentElement),"buy-rollback"!==e.getAttribute("id")&&(e=e.parentElement),"buy-rollback"===e.getAttribute("id")){t.preventDefault();const n=e.parentElement.previousElementSibling.querySelector('select[name="magnitude"]').value,c=e.previousElementSibling.value,i=r.dataset.csrfName,u=r.dataset.csrfValue;if(""===c.trim())return!1;let m=`product_price_id=${n}&product_qty=${c}&${i}=${u}`,y="/kasir/beli_produk_transaksi";"rollback-transaction"===l.getAttribute("aria-label")&&(m+=`&transaction_id=${l.dataset.transactionId}`,y="/kasir/beli_produk_rollback_transaksi"),function(t,e,r,n,o,d,s,l,c){document.querySelector("div#transaction-loading").classList.remove("d-none"),o.classList.add("btn--disabled"),d.classList.add("btn--disabled"),s.classList.add("btn--disabled"),fetch(c,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:r}).finally((()=>{document.querySelector("div#transaction-loading").classList.add("d-none"),o.classList.remove("btn--disabled"),d.classList.remove("btn--disabled"),s.classList.remove("btn--disabled")})).then((t=>t.json())).then((r=>{if(void 0!==r.csrf_value&&(l.dataset.csrfValue=r.csrf_value),!0===r.success){t.previousElementSibling.value="";const o=t.parentElement.previousElementSibling.querySelector("p.product__sale"),d=parseInt(n)+parseInt(o.dataset.productSale);o.innerText=`Terjual ${d}`,o.dataset.productSale=d;const s=e.getAttribute("aria-label");if("transaction"===s||"rollback-transaction"===s){const o=t.parentElement.parentElement.dataset.productId,d=t.parentElement.previousElementSibling,s=d.querySelector("p.product__name").textContent,l=d.querySelector('select[name="magnitude"]').selectedOptions[0].dataset.productPrice,c=d.querySelector('select[name="magnitude"]').selectedOptions[0].text,i=parseInt(l)*parseInt(n),u=document.createElement("tr");u.setAttribute("data-product-id",o),u.setAttribute("data-transaction-detail-id",r.transaction_detail_id),u.innerHTML=`<td width="10"><a href="#" title="Hapus produk" id="remove-product"  class="text-hover-red">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="19" fill="currentColor" viewBox="0 0 16 16"><path d="M2.037 3.225l1.684 10.104A2 2 0 0 0 5.694 15h4.612a2 2 0 0 0 1.973-1.671l1.684-10.104C13.627 4.224 11.085 5 8 5c-3.086 0-5.627-.776-5.963-1.775z"/><path fill-rule="evenodd" d="M12.9 3c-.18-.14-.497-.307-.974-.466C10.967 2.214 9.58 2 8 2s-2.968.215-3.926.534c-.477.16-.795.327-.975.466.18.14.498.307.975.466C5.032 3.786 6.42 4 8 4s2.967-.215 3.926-.534c.477-.16.795-.327.975-.466zM8 5c3.314 0 6-.895 6-2s-2.686-2-6-2-6 .895-6 2 2.686 2 6 2z"/></svg>\n                    </a></td>\n                    <td width="10"><a href="#" title="Tambah jumlah produk" id="add-product-qty">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="17" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 11.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V11.5z"/></svg>\n                    </a></td>\n                    <td width="10"><a href="#" title="Kurangi jumlah produk" id="reduce-product-qty">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="17" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V4.5z"/></svg>\n                    </a></td>\n\n                    <td>${s}</td>\n                    <td id="price" data-price="${l}">\n                        ${a(parseInt(l))} / ${c}\n                    </td>\n                    <td id="qty" data-qty="${n}">${n}</td>\n                    <td id="payment" data-payment="${i}">${a(i)}</td>`,null!==e.querySelector("tr#empty-shopping-cart")&&e.querySelector("tr#empty-shopping-cart").remove(),e.querySelector("tbody").append(u);const m=e.querySelector("td#total-payment").dataset.totalPayment,y=e.querySelector("td#total-qty").dataset.totalQty,_=i+parseInt(m),v=parseInt(n)+parseInt(y);e.querySelector("td#total-qty").innerText=v,e.querySelector("td#total-qty").dataset.totalQty=v,e.querySelector("td#total-payment").innerText=a(_),e.querySelector("td#total-payment").dataset.totalPayment=_,p(parseInt(document.querySelector('input[name="customer_money"]').value),_)}}})).catch((t=>{console.error(t)}))}(e,l,m,c,o,d,s,r,y)}})),document.querySelector("aside.cart table.table tbody").addEventListener("click",(t=>{const e=r.dataset.csrfName,n=r.dataset.csrfValue;let o=t.target;"add-product-qty"!==o.getAttribute("id")&&(o=o.parentElement),"add-product-qty"!==o.getAttribute("id")&&(o=o.parentElement);let d=t.target;"reduce-product-qty"!==d.getAttribute("id")&&(d=d.parentElement),"reduce-product-qty"!==d.getAttribute("id")&&(d=d.parentElement);let s=t.target;if("remove-product"!==s.getAttribute("id")&&(s=s.parentElement),"remove-product"!==s.getAttribute("id")&&(s=s.parentElement),"add-product-qty"===o.getAttribute("id")){t.preventDefault();const a=o.parentElement.parentElement.dataset.transactionDetailId,d=parseInt(o.parentElement.parentElement.querySelector("td#price").dataset.price),s=parseInt(l.querySelector("td#total-payment").dataset.totalPayment),c=parseInt(o.parentElement.parentElement.querySelector("td#qty").dataset.qty)+1,i=parseInt(l.querySelector("td#total-qty").dataset.totalQty)+1,u=c*d,p=s+d,m=o.parentElement.parentElement.dataset.productId,_=document.querySelector(`div.product__item[data-product-id="${m}"] p.product__sale`);let v=0;null!==_&&(v=parseInt(_.dataset.productSale)+1),y(o,l,c,i,u,p,0,v,a,e,n,r)}else if("reduce-product-qty"===d.getAttribute("id")){t.preventDefault();const a=d.parentElement.parentElement.dataset.transactionDetailId,o=parseInt(d.parentElement.parentElement.querySelector("td#price").dataset.price),s=parseInt(l.querySelector("td#total-payment").dataset.totalPayment),c=parseInt(d.parentElement.parentElement.querySelector("td#qty").dataset.qty)-1,i=parseInt(l.querySelector("td#total-qty").dataset.totalQty)-1,u=c*o,p=s-o,m=d.parentElement.parentElement.dataset.productId,_=document.querySelector(`div.product__item[data-product-id="${m}"] p.product__sale`);let v=0;null!==_&&(v=parseInt(_.dataset.productSale)-1),y(d,l,c,i,u,p,0,v,a,e,n,r)}else if("remove-product"===s.getAttribute("id")){t.preventDefault();const o=s.parentElement.parentElement.dataset.transactionDetailId,d=parseInt(s.parentElement.parentElement.querySelector("td#payment").dataset.payment),c=parseInt(l.querySelector("td#total-payment").dataset.totalPayment),i=parseInt(s.parentElement.parentElement.querySelector("td#qty").dataset.qty),u=parseInt(l.querySelector("td#total-qty").dataset.totalQty)-i,m=c-d,y=s.parentElement.parentElement.dataset.productId,_=document.querySelector(`div.product__item[data-product-id="${y}"] p.product__sale`);let v=0;null!==_&&(v=parseInt(_.dataset.productSale)-i),function(t,e,r,n,o,d,s,l,c,i){let u=`transaction_detail_id=${s}&${l}=${c}`;"rollback-transaction"===e.getAttribute("aria-label")&&(u+=`&transaction_id=${e.dataset.transactionId}`),document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/hapus_produk_dari_keranjang_belanja",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:u}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((s=>{if(void 0!==s.csrf_value&&(i.dataset.csrfValue=s.csrf_value),!0===s.success){const s=t.parentElement.parentElement;e.querySelector("td#total-qty").innerText=r,e.querySelector("td#total-qty").dataset.totalQty=r,e.querySelector("td#total-payment").innerText=a(n),e.querySelector("td#total-payment").dataset.totalPayment=n,null!==o&&(o.innerText=`Terjual ${d}`,o.dataset.productSale=d),s.remove(),p(parseInt(document.querySelector('input[name="customer_money"]').value),n),null===e.querySelector("tbody tr")&&(e.querySelector("tbody").innerHTML='<tr id="empty-shopping-cart"><td colspan="7"></td></tr>')}})).catch((t=>{console.error(t)}))}(s,l,u,m,_,v,o,e,n,r)}})),s.addEventListener("click",(t=>{t.preventDefault();const e=r.dataset.csrfName,a=r.dataset.csrfValue,n=document.querySelector('input[name="customer_money"]').value;"rollback-transaction"===l.getAttribute("aria-label")?function(t,e,a,r,n,o){const d=a.dataset.transactionId;document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/rollback_transaksi_selesai",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`transaction_id=${d}&customer_money=${o}&${t}=${e}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((t=>{void 0!==t.csrf_value&&(r.dataset.csrfValue=t.csrf_value),!0===t.success&&(n.click(),a.removeAttribute("data-transaction-id"),_(a)),!1===t.success&&void 0!==t.form_errors&&v(t.form_errors,"danger")})).catch((t=>{console.error(t)}))}(e,a,l,r,u,n):"transaction"===l.getAttribute("aria-label")&&function(t,e,a,r,n,o){document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/transaksi_selesai",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`customer_money=${o}&${t}=${e}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((t=>{void 0!==t.csrf_value&&(r.dataset.csrfValue=t.csrf_value),!0===t.success&&(n.click(),_(a)),!1===t.success&&void 0!==t.form_errors&&v(t.form_errors,"danger")})).catch((t=>{console.error(t)}))}(e,a,l,r,u,n)})),d.addEventListener("click",(t=>{t.preventDefault();const e=r.dataset.csrfName,a=r.dataset.csrfValue;"rollback-transaction"===l.getAttribute("aria-label")?h(e,a,l,r):"transaction"===l.getAttribute("aria-label")&&function(t,e,a,r){document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/transaksi_batal",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`${t}=${e}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((t=>{void 0!==t.csrf_value&&(r.dataset.csrfValue=t.csrf_value),!0===t.success&&(a.querySelectorAll("tbody tr[data-product-id]").forEach((t=>{const e=document.querySelector(`div.product__item[data-product-id="${t.dataset.productId}"] p.product__sale`);if(null!==e){const a=parseInt(e.dataset.productSale)-parseInt(t.querySelector("td#qty").dataset.qty);e.dataset.productSale=a,e.innerText=`Terjual ${a}`}})),_(a))})).catch((t=>{console.error(t)}))}(e,a,l,r)}));const f=document.querySelector(".modal"),q=f.querySelector(".modal__content");document.querySelector("a#rollback-transaction").addEventListener("click",(t=>{if(t.preventDefault(),"transaction"===l.getAttribute("aria-label")){const a=e("alert--warning","Tidak bisa melakukan rollback transaksi, karena kamu masih melakukan transaksi. Selesaikan atau batalkan transaksi, lalu coba kembali!");return t.target.parentElement.insertBefore(a,t.target),!1}if("rollback-transaction"===l.getAttribute("aria-label")){const a=e("alert--warning","Tidak bisa melakukan rollback transaksi lagi, karena kamu masih melakukan rollback transaksi. Selesaikan atau batalkan rollback transkasi, lalu coba kembali!");return t.target.parentElement.insertBefore(a,t.target),!1}const a=r.dataset.csrfName,n=r.dataset.csrfValue;document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/tampil_transaksi_tiga_hari_yang_lalu",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`${a}=${n}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((a=>{if(void 0!==a.csrf_value&&(r.dataset.csrfValue=a.csrf_value),a.transactions_three_days_ago.length>0){!function(t,e){t.classList.add("d-block"),setTimeout((()=>{t.classList.add("modal--fade-in")}),50),setTimeout((()=>{e.classList.add("modal__content--animate-show")}),200)}(f,q);let t="<option>Riwayat Transaksi</option>";a.transactions_three_days_ago.forEach((e=>{t+=`<option value="${e.transaksi_id}">${e.waktu_buat}</option>`})),q.querySelector('select[name="transactions_three_days_ago"]').innerHTML=t}else{const a=e("alert--info","Tidak ada transaksi dari 3 hari yang lalu.");t.target.parentElement.insertBefore(a,t.target)}})).catch((t=>{console.error(t)}))})),q.querySelector("a#btn-close").addEventListener("click",(e=>{e.preventDefault(),t(f,q),q.querySelector('select[name="transactions_three_days_ago"]').innerHTML=""})),document.querySelector("div.modal a#show-transaction-detail").addEventListener("click",(e=>{e.preventDefault();const n=r.dataset.csrfName,o=r.dataset.csrfValue,d=q.querySelector('select[name="transactions_three_days_ago"]').value;if("riwayat transaksi"===d.toLowerCase())return!1;e.target.nextElementSibling.classList.remove("d-none"),fetch("/kasir/tampil_transaksi_detail_tiga_hari_yang_lalu",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`transaction_id=${d}&${n}=${o}`}).finally((()=>{e.target.nextElementSibling.classList.add("d-none")})).then((t=>t.json())).then((e=>{if(void 0!==e.csrf_value&&(r.dataset.csrfValue=e.csrf_value),null!==e.customer_money){t(f,q),q.querySelector('select[name="transactions_three_days_ago"]').innerHTML="",c(l,e.transaction_details);const r=parseInt(e.customer_money);document.querySelector('input[name="customer_money"]').value=r;const n=parseInt(document.querySelector("aside.cart td#total-payment").dataset.totalPayment);document.querySelector('input[name="change_money"]').value=r>=n?a(r-n):"",l.setAttribute("aria-label","rollback-transaction"),l.setAttribute("data-transaction-id",d)}})).catch((t=>{console.error(t)}))}))}();
